<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Members - Shiloh Transformation Assembly</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .hidden { display: none; }
  </style>
</head>
<body class="bg-white text-green-900 font-sans">

  <!-- Logo -->
  <div class="text-center mt-6">
    <img src="sta logo.jpg" alt="Church Logo" class="h-20 mx-auto mb-2">
  </div>

  <header class="text-center">
    <h1 class="text-2xl font-bold">Shiloh Transformation Assembly</h1>
    <p class="italic">Where God is the Potter</p>
  </header>

  <!-- Password Login -->
  <section id="loginSection" class="text-center mt-8">
    <h2 class="text-xl font-bold mb-2">Members Access</h2>
    <input type="password" id="password" placeholder="Enter Password" class="border p-2 rounded">
    <button onclick="validatePassword()" class="bg-green-700 text-white px-4 py-2 rounded ml-2">Login</button>
    <p id="loginError" class="text-red-600 mt-2 hidden">Incorrect password. Try again.</p>
  </section>

  <!-- Members Content -->
  <section id="membersSection" class="hidden px-4 mt-10">
    <h2 class="text-xl font-bold text-center mb-4">Member Records</h2>

    <!-- Add/Update Member -->
    <div class="max-w-xl mx-auto mb-10">
      <h3 class="text-lg font-semibold mb-2">Add or Update Member</h3>
      <form id="memberForm" class="grid gap-2">
        <input type="hidden" id="memberId">
        <input type="text" id="fullName" placeholder="Full Name" class="border p-2 rounded">
        <input type="text" id="team" placeholder="Team" class="border p-2 rounded">
        <input type="text" id="phone" placeholder="Phone Number" class="border p-2 rounded">
        <input type="date" id="dateJoined" class="border p-2 rounded">
        <input type="text" id="notes" placeholder="Notes" class="border p-2 rounded">
        <input type="password" id="actionPassword" placeholder="Enter Password to Save" class="border p-2 rounded">
        <button type="submit" class="bg-green-800 text-white py-2 rounded">Save</button>
      </form>
    </div>

    <!-- Members Table -->
    <div class="overflow-x-auto">
      <table class="min-w-full border border-green-300">
        <thead>
          <tr class="bg-green-200">
            <th class="border px-2 py-1">ID</th>
            <th class="border px-2 py-1">Name</th>
            <th class="border px-2 py-1">Team</th>
            <th class="border px-2 py-1">Phone</th>
            <th class="border px-2 py-1">Date Joined</th>
            <th class="border px-2 py-1">Notes</th>
            <th class="border px-2 py-1">Actions</th>
          </tr>
        </thead>
        <tbody id="membersTableBody"></tbody>
      </table>
    </div>
  </section>

  <script>
    const sheetURL = "https://script.google.com/macros/s/AKfycbyX-Mol-CULrgtW18_wfrEbkTFYyxaqPeSHDp1joZhfQTsYofVBwkhbgD9gBgcMXvrBAA/exec";
    const accessPassword = "Shiloh707";

    function validatePassword() {
      const input = document.getElementById("password").value;
      if (input === accessPassword) {
        document.getElementById("loginSection").classList.add("hidden");
        document.getElementById("membersSection").classList.remove("hidden");
        loadMembers();
      } else {
        document.getElementById("loginError").classList.remove("hidden");
      }
    }

    async function loadMembers() {
      const res = await fetch(sheetURL + "?action=read");
      const data = await res.json();
      const tbody = document.getElementById("membersTableBody");
      tbody.innerHTML = "";
      data.forEach((member, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td class="border px-2 py-1">${member["Member ID"]}</td>
          <td class="border px-2 py-1">${member["Full Name"]}</td>
          <td class="border px-2 py-1">${member.Team}</td>
          <td class="border px-2 py-1">${member["Phone Number"]}</td>
          <td class="border px-2 py-1">${member["Date Joined"]}</td>
          <td class="border px-2 py-1">${member.Notes}</td>
          <td class="border px-2 py-1 space-x-2">
            <button onclick='editMember(${JSON.stringify(member)})' class="text-blue-700">Edit</button>
            <button onclick='deleteMember("${member["Member ID"]}")' class="text-red-700">Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function editMember(member) {
      document.getElementById("memberId").value = member["Member ID"];
      document.getElementById("fullName").value = member["Full Name"];
      document.getElementById("team").value = member.Team;
      document.getElementById("phone").value = member["Phone Number"];
      document.getElementById("dateJoined").value = member["Date Joined"];
      document.getElementById("notes").value = member.Notes;
      window.scrollTo(0, 0);
    }

    async function deleteMember(id) {
      const pw = prompt("Enter password to delete:");
      if (pw !== accessPassword) return alert("Incorrect password!");
      const res = await fetch(sheetURL + `?action=delete&id=${id}`);
      const result = await res.text();
      alert(result);
      loadMembers();
    }

    document.getElementById("memberForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const pw = document.getElementById("actionPassword").value;
      if (pw !== accessPassword) return alert("Incorrect password!");

      const payload = {
        id: document.getElementById("memberId").value,
        name: document.getElementById("fullName").value,
        team: document.getElementById("team").value,
        phone: document.getElementById("phone").value,
        date: document.getElementById("dateJoined").value,
        notes: document.getElementById("notes").value,
        action: "save"
      };

      const res = await fetch(sheetURL, {
        method: "POST",
        body: JSON.stringify(payload)
      });

      const result = await res.text();
      alert(result);
      document.getElementById("memberForm").reset();
      loadMembers();
    });
  </script>

</body>
</html>
